package rtw.entity.gererAvis.avisGlobal.entity;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.Collection;

import javax.persistence.CascadeType;
import javax.persistence.Embeddable;
import javax.persistence.EmbeddedId;
import javax.persistence.Entity;
import javax.persistence.FetchType;
import javax.persistence.Inheritance;
import javax.persistence.InheritanceType;
import javax.persistence.OneToMany;
import javax.persistence.OneToOne;

import rtw.entity.gererAvis.avisGlobal.avisGlobalAgence.entity.AvisGlobalAgence;
import rtw.entity.gererAvis.avisGlobal.avisGlobalAnnonce.entity.AvisGlobalAnnonce;
import rtw.entity.gererAvis.avisGlobal.interfaces.IAvisGlobal;
import rtw.entity.gererAvis.entityTest.Item;
import rtw.entity.gererAvis.entityTest.Utilisateur;
import rtw.entity.gererAvis.note.entity.Note;

/**
 * Entity {@link AvisGlobal} class mere abstraite de {@link AvisGlobalAgence} et {@link AvisGlobalAnnonce}.
 * 
 * @author Aurélien
 * @version 1
 * @since 13/03/2017
 *
 */
@Entity
@Inheritance(strategy=InheritanceType.SINGLE_TABLE)
public abstract class AvisGlobal implements IAvisGlobal,Serializable {

	
	/**
	 * Generated ID, need to be modified if Entity is modified
	 */
	private static final long serialVersionUID = -5377843581640163194L;

	/**
	 * TODO Récupération d'un utilisateur/Item + ID lié (projet commun)
	 * IdAvisGlobal est un double ID recupéré des fonctionnalitée GererSite,GererAnnonce grace a leur service respectif.
	 * 
	 * @author Aurélien
	 * @version 1
	 * @since 14/03/2017
	 *
	 */
	@Embeddable
	public static class IdAvisGlobal implements Serializable{

		/**
		 * TODO
		 * Serial generated by default regenerate it when class complete 
		 */
		private static final long serialVersionUID = 1L;
		
		private String idUtilisateur;
		private String idItem;
		
		/**
		 * Default construtor
		 */
		public IdAvisGlobal() {
			
		}
		
		/**
		 * Complete constructor 
		 * 
		 * @param idUtilisateur
		 * @param idItem
		 */
		public IdAvisGlobal(String idUtilisateur, String idItem) {
			
			super();
			this.idUtilisateur = idUtilisateur;
			this.idItem = idItem;
			
		}
		
		@Override
		public boolean equals(Object obj) {
			// TODO Auto-generated method stub
			return super.equals(obj);
		}
		
		@Override
		public int hashCode() {
			// TODO Auto-generated method stub
			return super.hashCode();
		}
		
		public String getIdUtilisateur() {
			return idUtilisateur;
		}
		public void setIdUtilisateur(String idUtilisateur) {
			this.idUtilisateur = idUtilisateur;
		}

		public String getIdItem() {
			return idItem;
		}

		public void setIdAnnonce(String idItem) {
			this.idItem = idItem;
		}
	}
	
	@EmbeddedId
	private IdAvisGlobal idAvisGlobal;
	
	@OneToMany(fetch=FetchType.EAGER,cascade=CascadeType.ALL)
	private Collection<Note> notes = new ArrayList<Note>();
	
	//TODO Supression na pas a existé
	@OneToOne(fetch=FetchType.EAGER,cascade=CascadeType.PERSIST)
	private Utilisateur utilisateur;
	
	//TODO CascadeType a modifier utiliser que pour test
	@OneToOne(fetch=FetchType.EAGER,cascade=CascadeType.PERSIST)
	private Item item;		
	
	/**
	 * Default constructor
	 */
	public AvisGlobal(){
		
	}
	
	/**
	 * Constructeur avec ID 
	 * 
	 * @param utilisateur {@link Utilisateur}
	 * @param item {@link Item}
	 */
	public AvisGlobal(Utilisateur utilisateur,Item item){
		
		getId().setIdAnnonce(item.getIdItem());
		getId().setIdUtilisateur(utilisateur.getIdUtilisateur());
		
		setItem(item);
		setUtilisateur(utilisateur);
		
	}
	
	/**
	 * Retourne l'ID de l'avis.
	 * 
	 * @return idAvisGlobal {@link IdAvisGlobal}
	 */
	public IdAvisGlobal getId() {
		return idAvisGlobal;
	}
	
	/**
	 * Renseigne l'ID de l'avis.
	 * 
	 * @param idAvisGlobal {@link IdAvisGlobal}
	 */
	public void setId(Utilisateur utilisateur,Item item) {
		
		this.idAvisGlobal = new IdAvisGlobal(utilisateur.getIdUtilisateur(), item.getIdItem());
		
	}
	
	/**
	 * Retourne la notesGlobal de l'avis.
	 * 
	 * @return notesGlobal {@link NotesGlobal}
	 */
	public Collection<Note> getNotes() {
		return notes;
	}
	
	/**
	 * Renseigne la notesGlobal de l'avis.
	 * 
	 * @param notesGlobal {@link NotesGlobal}
	 */
	public void setNotes(Collection<Note> notes) {
		this.notes = notes;
	}

	/**
	 * @return the idAvisGlobal
	 */
	public IdAvisGlobal getIdAvisGlobal() {
		return idAvisGlobal;
	}

	/**
	 * @param idAvisGlobal the idAvisGlobal to set
	 */
	public void setIdAvisGlobal(IdAvisGlobal idAvisGlobal) {
		this.idAvisGlobal = idAvisGlobal;
	}

	/**
	 * @return the utilisateur
	 */
	public Utilisateur getUtilisateur() {
		return utilisateur;
	}

	/**
	 * @param utilisateur the utilisateur to set
	 */
	public void setUtilisateur(Utilisateur utilisateur) {
		this.utilisateur = utilisateur;
	}

	/**
	 * @return the item
	 */
	public Item getItem() {
		return item;
	}

	/**
	 * @param item the item to set
	 */
	public void setItem(Item item) {
		this.item = item;
	}

}
